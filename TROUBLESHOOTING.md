# トラブルシューティングガイド

## Dify API 関連のトラブル

### エラー: "Dify API キーが設定されていません"

**原因**: 環境変数 `DIFY_API_KEY` が設定されていない。

**解決策**:

1. `.env.local` ファイルに `DIFY_API_KEY=あなたのDifyAPIキー` を追加する
2. Vercel にデプロイする場合は、プロジェクト設定の環境変数セクションでキーを追加する
3. サーバーを再起動して環境変数を反映させる

### エラー: "AI 回答の生成に失敗しました"

**原因**:

- Dify API へのリクエストが失敗した
- API のレート制限に達した
- API キーが無効

**解決策**:

1. ブラウザのコンソールとサーバーログでエラー詳細を確認する
2. API キーが有効か確認する
3. Dify ダッシュボードでアプリケーションのステータスを確認する
4. リクエストの構造が正しいかコードを確認する

### エラー: "CORS policy" または "No 'Access-Control-Allow-Origin' header"

**原因**: Dify API の CORS 設定が制限されている。

**解決策**:

1. フロントエンドから直接 Dify API を呼び出すのではなく、必ず Next.js の API ルート経由で呼び出す
2. 自己ホスティングの Dify の場合は、CORS 設定を調整する

### 回答品質に関する問題

**原因**: Dify のアプリケーション設定やナレッジベースの問題。

**解決策**:

1. Dify ダッシュボードでプロンプトテンプレートを調整する
2. ナレッジベースにより多くの関連文書を追加する
3. Dify アプリケーションの設定で使用するモデル（GPT-4, Claude など）を変更する
4. 質問の前処理と回答の後処理ロジックを調整する
